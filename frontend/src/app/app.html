<main class="page">
  <section class="hero">
    <p class="badge">Angular 21 + Dapr + ACA</p>
    <h1>Storefront Microservices Console</h1>
    <p>
      Workflow: frontend calls <code>storefront-api</code>, which invokes
      <code>products-service</code>, <code>cart-service</code>, and <code>checkout-service</code>
      through Dapr app IDs.
    </p>
  </section>

  <section class="panel">
    <h2>Connection</h2>
    <div class="grid">
      <label class="field field-wide">
        <span>Storefront API URL</span>
        <input [formControl]="apiBaseUrl" placeholder="http://localhost:8080" />
      </label>
      <button type="button" (click)="onApplyApiBaseUrl()">Apply</button>
      <button type="button" (click)="onLoadOverview()">Load Metadata</button>
      <button type="button" (click)="onLoadProducts()">Load Products</button>
    </div>
    <p class="status">{{ message() }}</p>
  </section>

  <section class="panel">
    <h2>Shop Session</h2>
    <div class="grid">
      <label class="field field-wide">
        <span>Customer ID</span>
        <input [formControl]="customerId" placeholder="cust-101" />
      </label>
      <button type="button" (click)="onLoadCart()" [disabled]="loading()">Load Cart</button>
      <button type="button" (click)="onCheckout()" [disabled]="loading()">Checkout</button>
      <button type="button" (click)="onLoadOrder()" [disabled]="loading()">Load Last Order</button>
    </div>
  </section>

  <section class="panel">
    <h2>Add To Cart</h2>
    <form [formGroup]="addToCartForm" class="grid">
      <label class="field field-wide">
        <span>Product</span>
        <select formControlName="productId">
          @for (product of products(); track product.id) {
            <option [value]="product.id">{{ product.name }} ({{ product.currency }} {{ product.price }})</option>
          }
        </select>
      </label>
      <label class="field">
        <span>Quantity</span>
        <input type="number" min="1" max="25" formControlName="quantity" />
      </label>
      <button type="button" (click)="onAddToCart()" [disabled]="loading() || products().length === 0">
        Add To Cart
      </button>
    </form>
  </section>

  <section class="panel">
    <h2>Dapr Workflow</h2>
    <div class="steps">
      <article>
        <h3>1. Service Invocation</h3>
        <p><code>storefront-api -> products-service/cart-service/checkout-service</code></p>
      </article>
      <article>
        <h3>2. State Store</h3>
        <p><code>cart-service</code> and <code>checkout-service</code> persist to <code>statestore</code>.</p>
      </article>
      <article>
        <h3>3. Pub/Sub Event</h3>
        <p><code>checkout-service</code> publishes <code>checkout.completed.v1</code> on <code>pubsub</code>.</p>
      </article>
      <article>
        <h3>4. Subscriber</h3>
        <p><code>cart-service</code> subscription receives event and clears cart asynchronously.</p>
      </article>
    </div>
  </section>

  <section class="panel">
    <h2>Live Output</h2>
    <div class="two-col">
      <article>
        <h3>Service Metadata</h3>
        <pre>{{ serviceInfo() | json }}</pre>
        <h3>Health</h3>
        <pre>{{ healthInfo() | json }}</pre>
      </article>
      <article>
        <h3>Products</h3>
        <pre>{{ products() | json }}</pre>
        <h3>Cart</h3>
        <pre>{{ cart() | json }}</pre>
        <h3>Latest Order</h3>
        <pre>{{ latestOrder() | json }}</pre>
      </article>
    </div>
  </section>

  <section class="panel">
    <h2>Recent Activity</h2>
    <ul class="activity">
      @for (entry of activity(); track entry) {
        <li>{{ entry }}</li>
      }
    </ul>
  </section>
</main>
